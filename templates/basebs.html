{% load extras %}
<!DOCTYPE html>
<!--suppress JSUnresolvedVariable -->
<html lang="es" data-location="EPUNEMI">
<head>
    <meta charset="utf-8">
    <title>{% block pagetitle %}{{ title|upper }}{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="author" content="OKSOFTWR">

    <!--SWEET ALERT-->
    <link href="/static/sweet2/sweetalert2.css?1.0.2" rel="stylesheet"/>
    <script src="/static/sweet2/sweetalert2.js?1.0.0"></script>
    <!--SWEET ALERT-->

    <script type='text/javascript' src="/static/js/jquery.min.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/jquery.blockUI.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/jquery.maskedinput.min.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/sysend.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/smoke.js?1.0.2"></script>
    <script type='text/javascript' src="/static/js/bs/bootstrap.min.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/bootstrap-datepicker.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/bootstrap-timepicker.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/bootstrap-modal.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/bootstrap-modalmanager.js?1.0.0"></script>
    <script type='text/javascript' src="/static/js/big.min.js?1.1.0"></script>
    <script type='text/javascript' src='/static/js/jquery.flexbox.js?1.0.0'></script>
    <script type='text/javascript' src='/static/js/dragdivscroll.js?1.0.0'></script>

    <link href="/static/css/smoke2.css?1.0.3" rel="stylesheet" type="text/css" media="screen"/>
    {#    <link href="/static/css/bootstrap.min2.css?1.0.2" rel="stylesheet"/>#}
    <link href="/static/css/bootstrap.min.css?1.0.3" rel="stylesheet"/>
    <link href="/static/css/bootstrap-responsive.css?4.0.0" rel="stylesheet"/>
    <link href='/static/css/font-awesome.css?1.0.1' rel='stylesheet'/>
    <link href='/static/css/font-awesome.min.css?1.0.1' rel='stylesheet'/>
    <link href="/static/css/backgroundcss.css?1.10" rel='stylesheet'/>

    {# DISEÑO 1 #}
    {#    <link href="/static/css/stylesbs.css?1.0.9" rel='stylesheet'/>#}
    {# DISEÑO 2 #}
    {#                <link href="/static/css/stylesbs2.css?1.10" rel='stylesheet'/>#}
    {# DISEÑO 3 #}
    {#            <link href="/static/css/stylesbs3.css?1.10" rel='stylesheet'/>#}
    {# DISEÑO 4 #}
    <link href="/static/css/stylesbs.css?5.14" rel='stylesheet'/>
    <link href="/static/css/datepicker.css?1.0.0" rel='stylesheet'/>
    <link href="/static/css/bootstrap-timepicker.css?1.0.0" rel='stylesheet'/>
    <link href="/static/css/bootstrap-modal.css?1.0.0" rel='stylesheet'/>
    <link href="/static/css/jquery.flexbox.css?1.0.0" type="text/css" rel="stylesheet"/>
    <link rel="shortcut icon" href="/static/logo/ep_azul.svg">
    <link href="/static/css/jquery.dataTables.css?1.0.0" type="text/css" rel="stylesheet"/>
    <script type='text/javascript' src='/static/js/jquery.dataTables.min.js?1.0.0'></script>

    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.bootstrap.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.colVis.min.js"></script>
    <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jszip/2.5.0/jszip.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.36/vfs_fonts.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.flash.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <style>

        .icon.hovered {
            /*background: #999;*/
            background: #9cb539;
            background: #13c2c2;
            background: #00CFDD;
            background: rgba(90, 141, 238, .15);
            color: white;
            color: #5A8DEE;
            cursor: pointer;
            /*border: 2.5px solid #859a2f;*/
            /*background-image: linear-gradient(to bottom, #038fde , #20C997);*/
        }

        .backgrounmarcaagua {
            min-height: 100vh;
            background: url('/static/images/covermarcadas.png') no-repeat fixed;
            background-size: 260px;
            background-position: 98% 90%;
        }

        @keyframes spinner-border {
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes spinner-grow {
            0% {
                transform: scale(0);
            }
            50% {
                opacity: 1;
                transform: none;
            }
        }

        .spinner-grow {
            display: inline-block;
            width: 15rem;
            height: 15rem;
            vertical-align: text-bottom;
            border-radius: 50%;
            opacity: 66%;
            animation: spinner-grow .75s linear infinite;
        }


        .dropdown-menu .divider_line {
            height: 1px;
            margin: 9px 0;
            overflow: hidden;
            background-color: #e5e5e5;
        !important;
        }

        .divScroll {
            height: 350px;

            overflow: scroll;
        }

        .scrollbar-dusty-grass::-webkit-scrollbar-track {
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-color: #F5F5F5;
            border-radius: 10px;
        }

        .scrollbar-dusty-grass::-webkit-scrollbar {
            width: 12px;
            background-color: #F5F5F5;
        }

        .scrollbar-dusty-grass::-webkit-scrollbar-thumb {
            border-radius: 10px;
            -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.1);
            background-image: -webkit-linear-gradient(330deg, #d4fc79 0%, #96e6a1 100%);
            background-image: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%);
        }

        .square::-webkit-scrollbar-track {
            border-radius: 0 !important;
        }

        .square::-webkit-scrollbar-thumb {
            border-radius: 0 !important;
        }

        .thin::-webkit-scrollbar {
            width: 10px;
        }

        .toggle_info {
            padding: 20px;
            background-color: #fff;
            box-shadow: 0 0 10px rgb(0 0 0 / 10%);
            border-top: 2px solid #034c79;
        }

        .normal-input {
            color: black;
            width: 100%;
            font-size: 12px;
            margin-bottom: 0;
            text-transform: initial;
        }

        .tablaBusquedaSearch td {
            padding-top: 8px;
            padding-bottom: 8px;
            padding-right: 3px;
            padding-left: 3px;
            line-height: 20px;
            text-align: left;
            vertical-align: top;
            border-top: 1px solid #ffffff;
        !important;
            border-left: transparent;
        }

        .tablaBusquedaSearch tbody tr.info:hover td {
            background-color: #F8F9F9 !important;
        }

        .tablaBusquedaSearch tbody tr.info td {
            background-color: transparent !important;
        }

        .tablaHoverOculto tbody tr.info:hover td {
            background-color: transparent !important;
        }

        .icon-container {
            position: relative;
            display: inline-block;
        }

        .blue-circle {
            position: absolute;
            top: -8px; /* Ajusta este valor según tu necesidad */
            left: 100%; /* Para que el círculo esté centrado horizontalmente */
            transform: translateX(-5%); /* Centrar el círculo horizontalmente */
            color: #ffae00; /* Color del círculo */
            background-color: #ffae00; /* Fondo del círculo */
            border-radius: 50%; /* Para darle forma de círculo */
        }

        /*Notificación*/

        .notification-box.active,
        .notification-box.msg p {
            line-height: 20px;
            font-size: 14px;
            font-weight: 400;
            margin-top: 2px;
        }

        .notification-box.msg .nott-list .notification-info span {
            bottom: auto;
            top: 5px;
        }

        .notification-box.msg .notification-info h3 {
            margin-bottom: 1px;
        }

        .notification-box.msg .nott-list .notfication-details {
            padding: 17px 20px 17px 20px;
        }

        .notification-box {
            position: absolute;
            top: 90%;
            right: 30%;
            width: 300px;
            background-color: #fff;
            opacity: 1;
            visibility: visible;
            z-index: 999;
            display: none;
            border-radius: 10px;
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.5);
        }

        .notification-box.active {
            opacity: 1;
            visibility: visible;
            z-index: 999999999;
        }

        .nt-title {
            float: left;
            width: 100%;
            border-bottom: 1px solid #e5e5e5;
            padding: 10px 20px;
        }

        .nt-title h4 {
            float: left;
            color: #686868;
            font-size: 14px;
        }

        .nt-title > a {
            float: right;
            color: #686868;
            font-size: 12px;
            font-weight: 600;
        }

        .nott-list .notification-info {
            width: 86%;
            float: left;
            text-align: left;
            position: relative;
        }

        .nott-list .notfication-details {
            padding: 0px 15px 0px 15px;
        }

        .nott-list .notification-info h3 {
            line-height: 18px;
        }

        {#.nott-list .notification-info span {#}
        {#    position: absolute;#}
        {#    bottom: 5px;#}
        {#    right: 0;#}
        {# }#}
        /* =============== notifications-list ============= */
        .notifications-list {
            float: left;
            width: 100%;
        }

        .notfication-details {
            float: left;
            width: 100%;
        {#padding: 20px;#} border-bottom: 1px solid #e5e5e5;
        }

        .notfication-details:last-child {
            border-bottom: 0;
        }

        .noty-user-img {
            float: left;
            width: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .noty-user-img img {
            width: 100%;
        }

        .notification-info {
            float: left;
            width: auto;
            padding-left: 10px;
        }

        .notification-info h3 {
            color: #686868;
            font-size: 14px;
            font-weight: 500;
            border: 0;
            padding: 0;
            margin-bottom: 0px;
            margin-top: 0px;
        }

        .notification-info h3 a {
        {#color: #000000;#} color: #5d5d5d;
            line-height: 14px;
            font-size: 14px;
        {#font-weight: 600;#} display: inline-block;
        }

        .notification-info > span {
        {#display: flex;#} color: #b2b2b2;
            font-size: 12px;
            font-weight: 600;
        }

        .noti-item {
            display: flex;
            padding-top: 10px;
            padding-bottom: 10px;

        {#border-bottom: 1px solid #c8d7ff;#}

        }

        .view-all-nots {
            float: left;
            width: 100%;

        }

        .view-all-nots > a {
            float: left;
            width: 100%;
            color: #818181;
            font-size: 14px;
        {#text-transform: capitalize;#} font-weight: 600;
            text-align: center;
            background-color: #ffffff;
            padding: 6px 0;
            border-radius: 20px;
        }

        /*Notificación*/
    </style>

    <script>

        function contactWS(tel, nombre) {
            if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
                let url = `https://wa.me/${tel}?text=Hola ${nombre}`;
                window.open(url);
            } else {
                if (tel.charAt(0) === "0") {
                    tel = tel.substring(1);
                }
                let url = `https://web.whatsapp.com/send?l=en&phone=${tel}&text=Hola ${nombre}`;
                window.open(url);
            }
        }

        NotificationJG = {
            success: function (msg, header/*=undefined*/, ttime/*=5000*/) {
                alertaSuccess(msg)
            },
            error: function (msg, header/*=undefined*/, ttime/*=5000*/) {
                alertaDanger(msg)
            },
            warning: function (msg, header/*=undefined*/, ttime/*=5000*/) {
                alertaWarning(msg)
            },
            info: function (msg, header/*=undefined*/, ttime/*=5000*/) {
                alertaInfo(msg)
            }
        };

        Confirm = {
            question: function (question, fun_yes/*=null*/, fun_no/*=null*/) {
                var $popup = $('#modalConfirm');

                $popup.modal({backdrop: 'static', keyboard: false}).modal('show');

                $('.modal-body p', $popup).html(question);

                $('.action_yes', $popup).off('click').on('click', function () {
                    if (typeof fun_yes != 'undefined') {
                        fun_yes();
                    }
                    $popup.modal('hide');
                });

                $('.action_not', $popup).off('click').on('click', function () {
                    if (typeof fun_no != 'undefined') {
                        fun_no();
                    }
                    $popup.modal('hide');
                });
            },
            ajax: function (aData, fun_yes/*=null*/, fun_no/*=null*/) {
                var d = {"action": "deleteView"}
                $.each(aData, function (index, value) {
                    d[index] = value
                });
                aData = d
                bloqueointerface();
                var $popup = $('#modalConfirmAjax');
                $.ajax({
                    type: "GET",
                    url: "/data",
                    data: aData,
                    success: function (data) {
                        if (data.result == 'ok') {
                            $('.modal-body', $popup).html(data.html);
                            var h = $(window).height() - 350;
                            $popup.modal({backdrop: 'static', keyboard: false, width: "60%", height: h}).modal('show');
                            $('.action_yes', $popup).off('click').on('click', function () {
                                if (typeof fun_yes != 'undefined') {
                                    fun_yes();
                                }
                                $popup.modal('hide');
                            });

                            $('.action_not', $popup).off('click').on('click', function () {
                                if (typeof fun_no != 'undefined') {
                                    fun_no();
                                }
                                $popup.modal('hide');
                            });
                        } else {
                            NotificationJG.error(data.mensaje);
                        }
                        desbloqueointerface();
                    },
                    error: function () {
                        desbloqueointerface();
                        NotificationJG.error("Error al enviar los datos.");
                    },
                    dataType: "json",
                });
            },

        };


        function getPromise(url, params) {
            return new Promise(resolve => {
                $.get(url, params, function (data) {
                    resolve(data);
                }, 'json');
            });
        }

        function soloNumerosValor(e) {
            key = e.keyCode || e.which;
            teclado = String.fromCharCode(key);
            letras = "1234567890.";
            if (letras.indexOf(teclado) == -1) {
                return false;
            }
        }

        function MinusText(e) {
            console.log($(this).val())
            console.log(e)
            {#return e.toLowerCase()#}
        }

        function eliminarajax(pk, nombre, accion) {
            Swal.fire({
                title: `Estás por eliminar este registro:\n ${nombre}`,
                text: "Esta acción es irreversible",
                type: 'warning',
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo!',
                cancelButtonText: 'Cancelar'
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.post("{{ request.path }}", {'action': accion, 'id': pk,}, function (data) {
                        $.unblockUI();
                        if (data.error === false) {
                            location.reload();
                        } else {
                            mensajeWarning(data.mensaje)
                        }
                    }, "json");
                } else {
                }
            })
        }

        function swalInputAjaxResponse(pk, accion, titulo='Estás por eliminar este registro:',text="Esta acción es irreversible",url="{{ request.path }}") {
            Swal.fire({
                title: `${titulo}`,
                text: text,
                type: 'warning',
                input: 'textarea',
                inputAttributes: {
                    placeholder:'Ingrese el motivo',
                    autocapitalize: 'off'
                },
                showCancelButton: true,
                allowOutsideClick: false,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: 'Si, deseo hacerlo!',
                cancelButtonText: 'Cancelar',
                preConfirm: (obser) => {
                    if (obser == null || obser == undefined || obser == '') {
                        Swal.showValidationMessage(
                            `Campo requerido`
                        )
                    }
                },
            }).then((result) => {
                if (result.value) {
                    bloqueointerface();
                    $.post(url, {'action': accion, 'id': pk,'observacion': result.value,}, function (data) {
                        $.unblockUI();
                        if (data.error === false) {
                            location.reload();
                        } else {
                            mensajeWarning(data.mensaje)
                        }
                    }, "json");
                } else {
                }
            })
        }

        function mensajeFlotante(tipo, mensaje) {
            Swal.fire({
                toast: false,
                position: 'center',
                icon: "info",
                type: 'info',
                title: mensaje,
                html: tipo,
                showConfirmButton: false
            });
        }

        function alertaSuccess(mensaje) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                type: 'success',
                title: mensaje,
                showConfirmButton: false,
                timer: 5000
            })
        }

        function alertaWarning(mensaje) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                type: 'warning',
                title: mensaje,
                showConfirmButton: false,
                timer: 5000
            })
        }

        function alertaInfo(mensaje) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                type: 'info',
                title: mensaje,
                showConfirmButton: false,
                timer: 5000
            })
        }

        function alertaDanger(mensaje) {
            Swal.fire({
                toast: true,
                position: 'top-end',
                type: 'error',
                title: mensaje,
                showConfirmButton: false,
                timer: 5000
            })
        }

        function mensajeSuccess(mensaje) {
            Swal.fire(mensaje, '{{ confi.alias }}', 'success')
        }

        function mensajeWarning(mensaje) {
            Swal.fire(mensaje, '{{ confi.alias }}', 'warning')
        }

        function mensajeDanger(mensaje) {
            Swal.fire(mensaje, '{{ confi.alias }}', 'error')
        }

        function converToAscii(str) {
            return str.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toUpperCase();
        }

        var modalposition = 0;
        var mensaje = '';

        $(document).ready(function () {
            $('[data-toggle="popover"]').popover({
                placement: 'top',
                trigger: 'hover'
            });
        });

        $(function () {
            //  ============ Notifications Open =============
            $(".not-box-open").on("click", function () {
                $(this).next("#notification").toggle();
            });
            $('.viewNotification_b').click(function () {
                var id = $(this).attr('id');
                var _href = $(this).attr('_href');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/notificacion",
                    data: {'action': 'ViewedNotification', 'id': id},
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            window.open(_href, '_blank');
                            location.reload()
                        } else {
                            mensajeWarning(data.mensaje);
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        mensajeWarning("Error de conexión.");
                    },
                    dataType: "json"
                });
            });
            //  ============ Messages Open =============
            if (!('contains' in String.prototype)) {
                String.prototype.contains = function (str, startIndex) {
                    return -1 !== String.prototype.indexOf.call(this, str, startIndex);
                };
            }

            $("*").focusin(function () {
                $('.datepicker').css({"display": "none"});
            });

            showWaiting = function (titulo, mensaje, close) {
                var panel = $("#waitpanel");
                $("#waitpaneltitle").html(titulo);
                $("#waitpanelbody").html(mensaje);
                if (!close) {
                    panel.modal({keyboard: false, backdrop: 'static'});
                }
                panel.modal("show");
            };

            hideWaiting = function () {
                $("#waitpanel").modal("hide");
            };

            sinurlatrasbutton = function () {
                if (location.pathname == '/') {
                    $("#urlatrasbutton").remove();
                }
            };

            deshabilitar = function (nombre) {
                $(nombre).attr({"disabled": "disabled"});
            };

            habilitar = function (nombre) {
                $(nombre).removeAttr("disabled").removeAttr("readonly");
            };

            // Funcion de redondeo que reemplaza a la funcion math.round() de javascript por fallos al redondear
            redondeo = function (numero, presicion) {
                var multiplicador = Math.pow(10, presicion + 1);
                var num_multi = Math.floor(numero * multiplicador);
                var num_redondeado = (Math.round(num_multi / 10)) * 10 / multiplicador;

                if (num_redondeado == 0) {
                    return 0;
                } else {
                    if (!isNaN(num_redondeado))
                        return num_redondeado;
                    else
                        return 0;
                }
            };


            openwindow_reporte = function (url, width, height) {
                newwindow = window.open(url, 'name', 'height=' + height + ' ,width=' + width);
            };


            openwindow = function (verb, url, data, target) {
                var form = document.createElement("form");
                form.action = url;
                form.method = verb;
                form.target = target || "_self";
                if (data) {
                    for (var key in data) {
                        var input = document.createElement("textarea");
                        input.name = key;
                        input.value = typeof data[key] === "object" ? JSON.stringify(data[key]) : data[key];
                        form.appendChild(input);
                    }
                    var csrf = document.createElement("input");
                    csrf.name = 'csrfmiddlewaretoken';
                    csrf.value = '{{ csrf_token }}';
                    form.appendChild(csrf);
                }
                form.style.display = 'none';
                document.body.appendChild(form);
                form.submit();
            };

            numerico = function (elemento, min, max, decimales) {
                var nvalor;
                var valor = elemento.val();
                if (valor == "") {
                    valor = parseFloat(0).toFixed(decimales);
                    elemento.val(valor);
                    return;
                }
                if (isNaN(valor)) {
                    nvalor = parseFloat(min).toFixed(decimales);
                    elemento.val(nvalor);
                    return;
                }
                if (valor < min) {
                    nvalor = parseFloat(min).toFixed(decimales);
                    elemento.val(nvalor);
                    return;
                }
                if (max > 0 && valor > max) {
                    nvalor = parseFloat(max).toFixed(decimales);
                    elemento.val(nvalor);
                    return;
                }
                nvalor = parseFloat(valor).toFixed(decimales);
                elemento.val(nvalor);
            };

            validacionesnumericas = function () {
                $(".validarnumero").blur(function () {
                    numerico($(this), 0, 0, 0);
                });

                $(".validarmoneda").blur(function () {
                    numerico($(this), 0, 0, 2);
                });
            };

            sinurlatrasbutton();

            $(".listaperiodos").click(function () {
                $("#periodospanel").modal("show");
            });

            $("#cerrarperiodospanel").click(function () {
                $("#periodospanel").modal("hide");
            });

            cerrar_viewhtml = function () {
                $("#viewhtml").modal("hide");
            };

            $("#seleccionarperiodospanel").click(function () {
                var pid = $("#periodoselectorall").val();
                $("#periodospanel").modal("hide");
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/",
                    data: {'action': 'periodo', 'id': pid},
                    success: function (data) {
                        if (data.result == 'ok') {
                            location.href = location.pathname;
                        } else {
                            $.unblockUI();
                            smoke.alert("Error al cambiar de periodo");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al cambiar de periodo");
                    },
                    dataType: "json"
                });
            });

            {% if chequear_correo %}
                chequearemial = function () {
                    $.ajax({
                        type: "POST",
                        url: "/api",
                        data: {'a': 'checkmail'},
                        success: function (data) {
                            if (data.result == 'ok') {
                                if (data.mensajes) {
                                    $("#checkmailicon").removeClass("hidden").show();
                                } else {
                                    $("#checkmailicon").addClass("hidden").hide();
                                }
                            }
                        },
                        dataType: "json"
                    });
                };

                setInterval(chequearemial, 60000);
            {% endif %}

            sleep = function (milliseconds) {
                var start = new Date().getTime();
                for (var i = 0; i < 1e7; i++) {
                    if ((new Date().getTime() - start) > milliseconds) {
                        break;
                    }
                }
            };

            {% if persona and check_session %}
                chequearsesion = function () {
                    $.ajax({
                        type: "POST",
                        url: "/api",
                        data: {'a': 'checksession'},
                        success: function (data) {
                            if (data.result == 'ok') {
                                if (data.nuevasesion) {
                                    bloqueointerface();
                                    location.href = '/logout';
                                }
                            }
                        },
                        dataType: "json"
                    });
                };

                setInterval(chequearsesion, 60000);
            {% endif %}

            bloqueointerface = function () {
                if (!$(".blockUI").length) {
                    $.blockUI({
                        message: $('#throbber'),
                        css: {
                            backgroundColor: 'transparent',
                            border: '0',
                            zIndex: 9999999
                        },
                        overlayCSS: {
                            backgroundColor: '#fff',
                            opacity: 0.8,
                            zIndex: 9999990
                        }
                    });
                }
            };

            {% if persona %}
                var check_logout;

                logout = function () {
                    bloqueointerface();
                    localStorage.clear();
                    $.ajax({
                        type: "POST",
                        url: "/api",
                        data: {'a': 'logout'},
                        success: function (data) {
                            if (data.result == 'ok') {
                                location.href = data.url;
                            } else {
                                logout();
                            }
                        },
                        error: function () {
                            logout();
                        },
                        dataType: "json"
                    });
                };

                $('.logoutuser').click(function () {
                    logout();
                });

                {% comment %}
                    window.onload = function () {
                        sysend.on('sga', function (obj) {
                            if (obj.message == 'check') {
                                if (window.name.length > 0) {
                                    localStorage.setItem('windowid', window.name);
                                    sysend.broadcast('sga', {message: 'set'});
                                }
                            }
                            if (obj.message == 'set') {
                                if (window.name.length == 0) {
                                    var windowid = localStorage.getItem('windowid');
                                    localStorage.removeItem('windowid');
                                    $.unblockUI();
                                    if (windowid) {
                                        window.name = windowid;
                                        clearInterval(check_logout);
                                    }
                                }
                            }
                        });

                        var sessionid = localStorage.getItem('sessionid');
                        if (sessionid) {
                            if (window.name != sessionid) {
                                $.blockUI({message: null});
                                sysend.broadcast('sga', {message: 'check'});
                                check_logout = setInterval(logout, 1000);
                            }
                        } else {
                            bloqueointerface();
                            logout();
                        }
                    };
                {% endcomment %}
            {% endif %}
            {% if currenttime %}
                serverdate = new Date({{ currenttime.year }}, {{ currenttime.month }}-1, {{ currenttime.day }}, {{ currenttime.hour }}, {{ currenttime.minute }}, {{ currenttime.second }}, 0);
                clientdate = new Date();

                showTime = function () {
                    var m;
                    var today = new Date();
                    var timediff = today - clientdate;
                    var renderdate = new Date(serverdate.getTime() + timediff);
                    var h = renderdate.getHours();
                    var mer = " AM";
                    if (h > 12) {
                        mer = " PM";
                        h -= 12;
                    }
                    m = renderdate.getMinutes();
                    m = checkTime(m);
                    $("#clock").text(h + ":" + m + mer);
                };

                checkTime = function (i) {
                    if (i < 10) {
                        i = "0" + i;
                    }
                    return i;
                };

                setInterval(showTime, 15000);

                showTime();
            {% endif %}
            {#$('#periodoselectorall').select2();#}

            $('#accPeriodo').click(function () {
                $('#buscarPeriodo').val('');
                var listaPeriodos = $('#listaPeriodos').children('li').toArray();
                for (i = 1; i < listaPeriodos.length; i++) {
                    var li = listaPeriodos[i];
                    $(li).removeAttr('style');
                }
            });

            $('#buscarPeriodo').mouseenter(function () {
                $(this).focus();
            });

            $('#buscarPeriodo').keyup(function () {
                var listaPeriodos = $('#listaPeriodos').children('li').toArray();
                for (i = 1; i < listaPeriodos.length; i++) {
                    var li = listaPeriodos[i];
                    if (!converToAscii($(li).children('a:first').html()).includes(converToAscii($(this).val()))) {
                        $(li).attr('style', 'display:none');
                    } else {
                        $(li).removeAttr('style');
                    }
                }
            });
            $(".listaperiodos").click(function () {
                $("#periodospanel").modal("show");
            });
            $("#cerrarperiodospanel").click(function () {
                $("#periodospanel").modal("hide");
            });


            $('.dropdown-toggle').dropdown();
            $(".collapse").collapse();
            $('.tips').tooltip({});

            $(".periodoselector").click(function () {
                var pid = $(this).attr('pid');
                bloqueointerface();
                $.ajax({
                    type: "POST",
                    url: "/",
                    data: {'action': 'periodofis', 'id': pid},
                    success: function (data) {
                        if (data.result == 'ok') {
                            location.href = location.pathname;
                        } else {
                            $.unblockUI();
                            smoke.alert("Error al cambiar de periodo");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al cambiar de periodo");
                    },
                    dataType: "json"
                });
            });

            $("#id_email, #id_emailinst, #id_correoinstasoc, #id_correoinst").css({'text-transform': 'none'});

            $("table tbody tr").hover(function () {
                $(this).addClass("info");
            }, function () {
                $(this).removeClass("info");
            });

            $(".btn-form").click(function () {
                bloqueointerface();
            });

            $(".bloqueo_pantalla").click(function () {
                bloqueointerface();
            });

            if (typeof String.prototype.startsWith != 'function') {
                String.prototype.startsWith = function (str) {
                    return this.indexOf(str) == 0;
                };
            }

            if (typeof String.prototype.endsWith != 'function') {
                String.prototype.endsWith = function (str) {
                    return this.slice(-str.length) == str;
                };
            }

            abrir_reporte = function () {
                var href = $(this).attr('nhref');
                var tipos = $(this).attr('tipos');
                if (!tipos) {
                    tipos = "pdf, xls, csv, doc";
                }
                if (tipos.contains("pdf")) {
                    $("#formatopdf").removeAttr("hidden");
                } else {
                    $("#formatopdf").attr({"hidden": "hidden"});
                }
                if (tipos.contains("doc")) {
                    $("#formatodoc").removeAttr("hidden");
                } else {
                    $("#formatodoc").attr({"hidden": "hidden"});
                }
                if (tipos.contains("xls")) {
                    $("#formatoxls").removeAttr("hidden");
                } else {
                    $("#formatoxls").attr({"hidden": "hidden"});
                }
                if (tipos.contains("csv")) {
                    $("#formatocsv").removeAttr("hidden");
                } else {
                    $("#formatocsv").attr({"hidden": "hidden"});
                }
                if (tipos.length > 4) {
                    primero = $("#formatoreporte_formato").find("option:first").val();
                    $("#formatoreporte_formato").val(primero);
                    $('#formatoreporte').modal({'width': '400'}).modal('show');
                    $('#formatoreporte_run').attr('nhref', href);
                } else {
                    primero = $("#formatoreporte_formato").find("option:first").val();
                    $("#formatoreporte_formato").val(primero);
                    ejecutar_reporte_directo(href);

                }

            };

            cerrar_reporte = function () {
                $('#formatoreporte').modal('hide');
            };

            ejecutar_reporte_directo = function (ruta) {
                var href = ruta;
                $('#formatoreporte').modal('hide');
                var formato = $('#formatoreporte_formato').val();
                var formato_final = '';
                if (formato == 0) {
                    formato_final = '&rt=pdf';
                } else if (formato == 1) {
                    formato_final = '&rt=docx';
                } else if (formato == 2) {
                    formato_final = '&rt=xlsx';
                } else if (formato == 3) {
                    formato_final = '&rt=csv';
                }
                bloqueointerface();
                var report_url = href + formato_final;
                $.ajax({
                    type: "POST",
                    url: report_url,
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            if (formato == 0) {
                                openwindow_reporte(location.origin + data.reportfile, 800, 500);
                            } else {
                                location.href = location.origin + data.reportfile;
                            }
                        } else {
                            smoke.alert("Error al generar el reporte");
                        }
                    },
                    error: function (jqXHR, exception) {
                        console.log(jqXHR)
                        console.log(exception)
                        $.unblockUI();
                        smoke.alert("Error al generar el reporte");
                    },
                    dataType: "json"
                });
            };

            ejecutar_reporte = function () {
                var href = $(this).attr('nhref');
                $('#formatoreporte').modal('hide');
                var formato = $('#formatoreporte_formato').val();
                var formato_final = '';
                if (formato == 0) {
                    formato_final = '&rt=pdf';
                } else if (formato == 1) {
                    formato_final = '&rt=docx';
                } else if (formato == 2) {
                    formato_final = '&rt=xlsx';
                } else if (formato == 3) {
                    formato_final = '&rt=csv';
                }
                bloqueointerface();
                var report_url = href + formato_final;
                $.ajax({
                    type: "POST",
                    url: report_url,
                    success: function (data) {
                        $.unblockUI();
                        if (data.result == 'ok') {
                            if (formato == 0) {
                                openwindow_reporte(location.origin + data.reportfile, 800, 500);
                            } else {
                                location.href = location.origin + data.reportfile;
                            }
                        } else {
                            smoke.alert("Error al generar el reporte");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error al generar el reporte");
                    },
                    dataType: "json"
                });
            };

            {% if mensj or info %}
                smoke.alert('{{ mensj }}{{ info }}');
            {% endif %}

            conectar_confirmacion = function () {
                var href = $(this).attr('nhref');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: href,
                    success: function (data) {
                        $.unblockUI();
                        if (data.search('"' + 'ajaxconfirmaciondinamicbs' + '"') >= 0) {
                            $("#confirmacionmodal").html(data);
                            $('#confirmacionmodal').modal({'width': '650'}).modal('show');
                        } else {
                            smoke.alert("Error de conexión.");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "html"
                });
            };

            conectar_eliminacion = function () {
                var href = $(this).attr('nhref');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: href,
                    success: function (data) {
                        $.unblockUI();
                        if (data.search('"' + 'ajaxdeletedinamicbs' + '"') >= 0) {
                            $("#eliminacionmodal").html(data);
                            $('#eliminacionmodal').modal({'width': '650'}).modal('show');
                        } else {
                            smoke.alert("Error de conexión.");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "html"
                });
            };

            conectar_viewhtml = function () {
                var href = $(this).attr('nhref');
                bloqueointerface();
                $.ajax({
                    type: "GET",
                    url: href,
                    success: function (data) {
                        $.unblockUI();
                        if (data.search('"' + 'ajaxconfirmaciondinamicbs' + '"') >= 0) {
                            $("#viewhtml").html(data);
                            $('#viewhtml').modal({'width': '650'}).modal('show');
                            $('.cerrarviewhtml').bind('click.cerrar_viewhtml', cerrar_viewhtml);
                        } else {
                            smoke.alert("Error de conexión.");
                        }
                    },
                    error: function () {
                        $.unblockUI();
                        smoke.alert("Error de conexión.");
                    },
                    dataType: "html"
                });
            };


            $('.confirmacionmodal').bind('click.conectar_confirmacion', conectar_confirmacion);
            $('.viewhtml').bind('click.conectar_viewhtml', conectar_viewhtml);
            $('.eliminacionmodal').bind('click.conectar_eliminacion', conectar_eliminacion);
            $(".reportedirecto").bind("click.conectar_reporte", abrir_reporte);
            $("#formatoreporte_run").bind("click.ejecutar_reporte", ejecutar_reporte);
            $("#formatoreporte_close").bind("click.cerrar_reporte", cerrar_reporte);

            conectar_reporte = function () {
                $(".reportedirecto").unbind("click.conectar_reporte");
                $(".reportedirecto").bind("click.conectar_reporte", abrir_reporte);
            };

            tooltips = function () {
                $(".tl").tooltip({placement: "left"});
                $(".tr").tooltip({placement: "right"});
                $(".tu").tooltip({placement: "top"});
                $(".tb").tooltip({placement: "bottom"});
            };

            tooltips();

            $('.selectorfecha').keypress(function () {
                return false;
            });

            history.pushState(null, null, location.href);
            window.addEventListener('popstate', function (event) {
                history.pushState(null, null, location.href);
            });

            actualizarnumerico = function () {
                $('.imp-number[decimal], .imp-moneda[decimal], .imp-numbersmall[decimal], .imp-numbermed-right[decimal], .imp-numbermed-center[decimal], .nota[decimal]').each(function () {
                    numerico($(this), 0, 0, $(this).attr('decimal'));
                })
            };

            escapeHTMLEncode = function (str) {
                var div = document.createElement('div');
                var text = document.createTextNode(str);
                div.appendChild(text);
                return div.innerHTML;
            };

            actualizarnumerico();

            $('.imp-number, .imp-moneda, .imp-numbersmall, .imp-numbermed-right, .imp-numbermed-center, .nota').focus(function () {
                if (!parseFloat($(this).val())) {
                    $(this).val("");
                }
            });

            $('.selectorfecha').keypress(function () {
                return false;
            });

            tipo_formulario = function (elemento) {
                if (elemento.attr('formtype') == 'form-vertical') {
                    elemento.find(".control-label").css({'float': 'none'});
                    elemento.find(".label-text").css({'text-align': 'left'});
                    elemento.find(".control-label").each(function () {
                        var contenedor = parseFloat($(this).parent().css('width')) - 5;
                        $(this).css({'width': contenedor.toString() + 'px'});
                    });
                    elemento.find(".control").each(function () {
                        var contenedor = parseFloat($(this).parent().css('width')) - 5;
                        $(this).css({'width': contenedor.toString() + 'px'});
                    });

                } else {
                    elemento.find(".control-label").css({'float': 'left'});
                    elemento.find(".label-text").css({'text-align': 'right'});
                    if (elemento.hasClass('form-modal')) {
                        elemento.find(".control-group").each(function () {
                            var contenedor = parseFloat($(this).parent().width());
                            var porciento = (parseFloat($(this).width()) / 100);
                            var tam = parseInt(contenedor * porciento);
                            $(this).css({'width': tam});
                        });
                    }
                    elemento.find(".control-label").each(function () {
                        if ($(this).attr('labelwidth')) {
                            $(this).css({'width': $(this).attr('labelwidth')});
                        } else {
                            $(this).css({'width': '160px'});
                        }
                    });
                    elemento.find(".control").each(function () {
                        var contenedor = $(this).parent().width();
                        var label = parseFloat($(this).parent().find('.control-label').width());
                        $(this).css({'width': ((contenedor - label) - 20).toString() + 'px'});
                    });
                }
                elemento.find(".select2").css({'width': '100%'});
            };

            tipo_formulario_old = function (elemento) {
                if (elemento.attr('formtype') == 'form-vertical') {
                    elemento.find(".control-label").css({'float': 'none'});
                    elemento.find(".label-text").css({'text-align': 'left'});
                    elemento.find(".control-label").each(function () {
                        var contenedor = parseFloat($(this).parent().css('width')) - 5;
                        $(this).css({'width': contenedor.toString() + 'px'});
                    });
                    elemento.find(".control").each(function () {
                        var contenedor = parseFloat($(this).parent().css('width')) - 5;
                        $(this).css({'width': contenedor.toString() + 'px'});
                    });

                } else {
                    elemento.find(".control-label").css({'float': 'left'});
                    elemento.find(".label-text").css({'text-align': 'right'});
                    if (elemento.hasClass('form-modal')) {
                        elemento.find(".control-group").each(function () {
                            var contenedor = parseFloat($(this).parent().width());
                            var porciento = (parseFloat($(this).width()) / 100);
                            var tam = parseInt(contenedor * porciento);
                            $(this).css({'width': tam});
                        });
                    }
                    elemento.find(".control-label").each(function () {
                        if ($(this).attr('labelwidth')) {
                            $(this).css({'width': $(this).attr('labelwidth')});
                        } else {
                            $(this).css({'width': '160px'});
                        }
                    });
                    elemento.find(".control").each(function () {
                        var contenedor = $(this).parent().width();
                        var label = parseFloat($(this).parent().find('.control-label').width());
                        $(this).css({'width': ((contenedor - label) - 20).toString() + 'px'});
                    });
                }
                elemento.find(".select2").css({'width': '100%'});
            };

            pop_lista = function (arr, item) {
                for (var i = arr.length; i--;) {
                    if (arr[i] === item) {
                        arr.splice(i, 1);
                    }
                }
            };
        });

        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }

        var csrftoken = getCookie('csrftoken');

        function csrfSafeMethod(method) {
            return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
        }

        $.ajaxSetup({
            beforeSend: function (xhr, settings) {
                if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                    xhr.setRequestHeader("X-CSRFToken", csrftoken);
                }
            }
        });

        function consultar(pk, accion, nombre, ruta, ocultarcerrar = false, valor = 0, campo = 'default') {
            $.ajax({
                type: "GET",
                url: `/${ruta}`,
                data: {'action': accion, 'id': pk, 'adicionalvalor': valor, 'adicionalcampo': campo},
                success: function (data) {
                    if (data.result === true) {
                        if (ocultarcerrar === true) {
                            $('#footerModalView').hide();
                        }
                        $('.tablaaqui').html(data.data)
                        $('#frmConsulta #nombre').html(nombre);
                        $('#modalConsulta').modal({"backdrop": "static", "width": "1000px"}).modal("show");
                    } else {
                        mensajeWarning(data.mensaje);
                    }
                },
                error: function () {
                    smoke.alert("Error de conexión.");
                },
                dataType: "json"
            });
        }

        function bloqueointerface() {
            $.blockUI({
                message: '<span class="spinner-grow spinner-border-lg text-info" role="status" aria-hidden="true" style="width: 10rem; height: 10rem;"></span>',
                css: {
                    backgroundColor: 'transparent',
                    border: '0',
                    zIndex: 9999999
                },
                overlayCSS: {
                    backgroundColor: '#fff',
                    opacity: 0.8,
                    zIndex: 9999990
                }
            });
        }

        function pantallaespera() {
            $.blockUI({
                message: '<span class="spinner-grow spinner-border-lg text-info" role="status" aria-hidden="true" style="width: 10rem; height: 10rem;"></span>',
                css: {
                    backgroundColor: 'transparent',
                    border: '0',
                    zIndex: 9999999
                },
                overlayCSS: {
                    backgroundColor: '#fff',
                    opacity: 0.8,
                    zIndex: 9999990
                }
            });
        }

        $(document).ready(function () {
            $(document).on('click', function () {
                // Acción que quieres ejecutar al hacer clic en cualquier lugar de la página
                if (!$(event.target).closest(".not-box-open, #notification").length) {
                    $(".not-box-open").next("#notification").hide();
                }
            });
            const tabla_paginada = $('.tabla_nopaginada_noboton_2').DataTable({
                responsive: true,
                ordering: false,
                paging: false,
                searching: true,
                bInfo: false,
                dom: "<<'col-sm-12 col-md-3'f><'col-sm-12 col-md-3'l><'col-sm-12 col-md-12'B>>" +
                    "<<'col-sm-12'tr>>" +
                    "<<'col-md-6 col-sm-12'i><'col-md-4 col-sm-12'p>>",
                buttons: []
            });
        });

        $(document).ready(function () {
            const tabla_paginada = $('.tabla_nopaginada_noboton').DataTable({
                responsive: true,
                ordering: false,
                paging: false,
                searching: true,
                bInfo: true,
                dom: "<<'col-sm-12 col-md-3'f><'col-sm-12 col-md-3'l><'col-sm-12 col-md-12'B>>" +
                    "<<'col-sm-12'tr>>" +
                    "<<'col-md-6 col-sm-12'i><'col-md-4 col-sm-12'p>>",
                buttons: []
            });
            $('.tabla_nopaginada_noboton tbody').on('click', 'tr', function () {
                var data = tabla_paginada.row(this).data();
            });
        });

        $(document).ready(function () {
            const tabla_paginada = $('.tabla_paginada').DataTable({
                responsive: true,
                ordering: false,
                paging: true,
                searching: true,
                bInfo: true,
                dom: "<<'col-sm-12 col-md-3'f><'col-sm-12 col-md-3'l><'col-sm-12 col-md-12'B>>" +
                    "<<'col-sm-12'tr>>" +
                    "<<'col-md-6 col-sm-12'i><'col-md-4 col-sm-12'p>>",
                buttons: [{
                    extend: 'colvis',
                    text: '<i class="fa fa-eye"></i> Ver Columnas'
                }]
            });
            $('.tabla_paginada tbody').on('click', 'tr', function () {
                var data = tabla_paginada.row(this).data();
            });
        });

        function soloNumeros(e) {
            key = e.keyCode || e.which;
            teclado = String.fromCharCode(key);
            letras = "1234567890.";
            teclado_especial = false;
            if (letras.indexOf(teclado) == -1 && !teclado_especial) {
                return false;
            }
        }

        function soloNumerosPunto(e) {
            key = e.keyCode || e.which;
            teclado = String.fromCharCode(key);
            letras = "1234567890.";
            teclado_especial = false;
            if (letras.indexOf(teclado) == -1 && !teclado_especial) {
                return false;
            }
        }


        function sololetras(e) {
            key = e.keyCode || e.which;
            teclado = String.fromCharCode(key);
            letras = "abcdefghijklmnopqrstuwxyzABCDEFGHIJKLMNÑOPQRSTUWXYVvZñ ";
            teclado_especial = false;
            if (letras.indexOf(teclado) == -1 && !teclado_especial) {
                return false;
            }
        }

    </script>

    {% block heading %}
    {% endblock %}

</head>

<body data-spy="scroll" data-target=".subnav" data-offset="50"
      {% if not persona %}class='{% block contentextraclass %}{% endblock %}{% endif %}'>

<div id="app">
    <div id="nav-header" class="navbar navbar-inverse navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                <ul class="nav">
                    <li>
                        <a style="font-size: 16px;" href="/" class="hidden-phone hidden-tablet visible-desktop">
                            {% if request.user.is_authenticated %}
                                <span style="font-size: 22px; font-weight: bold;">SANTA ELENA </span> {% endif %}
                        </a>
                        <a href="/" class="visible-phone visible-tablet hidden-desktop">
                            <img style="height: 32px; width: 111px;" src="/static/logo/logo_ep_blanco.png">
                        </a>
                    </li>
                </ul>
                {% if not request.user.is_anonymous %}
                    <div class="pull-right hidden-phone hidden-tablet visible-desktop">
                        <ul class="nav">
                            {#                            {% if totnotification %}#}
                            <li>
                                <a href="javascript:void(0)" class="not-box-open" data-original-title="">
                                    <div class="icon-container">
                                        {% if totnotification > 0 %}
                                            <i class="fas fa-circle blue-circle"></i>
                                        {% endif %}
                                        <i class="fa fa-bell"
                                           style="font-size: 18px; {% if totnotification > 0 %}color:#ffae00{% endif %}"></i>
                                    </div>
                                </a>
                                <div class="notification-box" id="notification">
                                    <div class="nt-title">
                                        <h4>Notificaciones</h4>
                                        {#                                            <a href="javascript:void(0)" title="">Limpiar todo</a>#}
                                    </div>
                                    <div class="nott-list">
                                        <div class="notfication-details">
                                            {% for notification in listnotification %}
                                                <a _href="{{ notification.url }}" href="javascript:void(0)"
                                                   id="{{ notification.id }}" class="viewNotification_b">
                                                    <div class="noti-item">
                                                        <div class="noty-user-img">
                                                            <img src="https://sga.unemi.edu.ec/static/logos/noti_mensaje.svg"
                                                                 alt="">
                                                        </div>
                                                        <div class="notification-info">
                                                            <h3>
                                                                {{ notification.titulo }}
                                                            </h3>
                                                            <span><i
                                                                    class="fa fa-calendar"></i> hace {{ notification.diasingresado }} dias</span>
                                                        </div><!--notification-info -->
                                                    </div>
                                                </a>
                                                {% if not forloop.last %}
                                                    <hr style="margin-top: 0px; margin-bottom: 0px">
                                                {% endif %}
                                                {% empty %}
                                                <div class="" style="text-align: center; color: #848586">
                                                    <p style="font-size: 15px;font-weight: normal"> Sin
                                                        notificaciones</p>
                                                </div>
                                            {% endfor %}
                                        </div>
                                        <div class="view-all-nots">
                                            <a href="/notificacion" title=""><i class="fa fa-bell"></i> Ver mis
                                                notificaciones</a>
                                        </div>
                                    </div><!--nott-list end-->
                                </div><!--notification-box end-->
                            </li>
                            {#                            {% endif %}#}
                            <ul class="nav">
                                {% if perms.sagest.notificar_pagos_alumnos %}
                                    {% if pagospendientesap %}
                                        <li id="checkpayicon">
                                            <a href="/fin_comprobantesalumnos?estados=1" style="margin-top: 0.9px;"
                                               class="tb"
                                               title="ALERTA {{ pagospendientescount }} PAGOS PENDIENTES DE REVISIÓN">
                                                <i class="fa fa-bell fa-2x blinkimg tr" border=0></i>
                                                {% if pagospendientescount > 0 %}
                                                    <sup style="top: -10px; left: -3px;"><label
                                                            class="label label-warning"
                                                            style="padding: 4px; font-size: 8px;line-height: 8px;">{{ pagospendientescount }}</label></sup>
                                                {% endif %}
                                            </a>
                                        </li>
                                        {#                                    <ul class="nav" id="btnNotificacionTareas">#}
                                        {#                                        <li class="dropdown has_hover">#}
                                        {#                                            <a style="height: 50px;" href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">#}
                                        {#                                                {% if totalnotarchivos > 0 %}#}
                                        {#                                                    <label class="label label-warning"#}
                                        {#                                                           style="padding: 4px; font-size: 8px;line-height: 8px;">{{ totalnotarchivos }}</label>#}
                                        {#                                                {% endif %}#}
                                        {#                                                <i class="fa fa-download fa-2x" id="btnNotiIcono"></i>#}
                                        {#                                                <b class="caret"></b>#}
                                        {#                                            </a>#}
                                        {#                                            <ul class="dropdown-menu pull-right">#}
                                        {#                                                {% for a in notificacionesarchivos %}#}
                                        {#                                                    <li>#}
                                        {#                                                        <a _href="{{ a.url }}" href="javascript:void(0)" id="{{ a.id }}" class="btn-form viewNotification_b">#}
                                        {#                                                            {% if a.en_proceso %}<i class="fa fa-cog fa-spin text-info"></i>{% else %}<i class="fa fa-check-circle text-success"></i>{% endif %} {{ a.titulo }}<br>#}
                                        {#                                                            <span class="text-muted">hace {{ a.diasingresado }} dias</span>#}
                                        {#                                                        </a>#}
                                        {#                                                    </li>#}
                                        {#                                                {% empty %}#}
                                        {#                                                    <li>#}
                                        {#                                                        <a href="javascript:;" class="btn-form"><i class="fa fa-times-circle"></i> Sin notificaciones.</a>#}
                                        {#                                                    </li>#}
                                        {#                                                {% endfor %}#}
                                        {#                                                <li><a href="/notificacion" class="btn-form"><i class="fa fa-list"></i> Ver mis notificaciones</a></li>#}
                                        {#                                            </ul>#}
                                        {#                                        </li>#}
                                        {#                                    </ul>#}
                                    {% endif %}
                                    {% if qsincidenciaPedidoAp %}
                                        <li id="checkpayicon">
                                            <a target="_blank" href="/adm_pedidosonline?action=incidencias&estado=1"
                                               style="margin-top: 0.9px;"
                                               class="tb"
                                               title="ALERTA {{ qsincidenciaPedido }} INCIDENCIAS POR ATENDER">
                                                <i class="fa fa-list-alt fa-2x blinkimg tr" border=0></i>
                                                {% if qsincidenciaPedido > 0 %}
                                                    <sup style="top: -10px; left: -3px;"><label
                                                            class="label label-warning"
                                                            style="padding: 4px; font-size: 8px;line-height: 8px;">{{ qsincidenciaPedido }}</label></sup>
                                                {% endif %}
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if qsinscritosPagoAp %}
                                        <li id="checkpayicon">
                                            <a target="_blank" href="/rec_carteravencida?revision=1"
                                               style="margin-top: 0.9px;"
                                               class="tb"
                                               title="ALERTA {{ qsinscritosPago }} INSCRITOS CON TENTATIVA DE PAGO ALCANZADA">
                                                <i class="fa fa-list-alt fa-2x blinkimg tr" border=0></i>
                                                {% if qsinscritosPago > 0 %}
                                                    <sup style="top: -10px; left: -3px;"><label
                                                            class="label label-warning"
                                                            style="padding: 4px; font-size: 8px;line-height: 8px;">{{ qsinscritosPago }}</label></sup>
                                                {% endif %}
                                            </a>
                                        </li>
                                    {% endif %}
                                    {% if qspedidoOnlineAp %}
                                        <li id="checkpayicon">
                                            <a href="/adm_pedidosonline?estados=1" style="margin-top: 0.9px;"
                                               class="tb"
                                               title="ALERTA {{ qspedidoOnline }} PAGOS ONLINE PENDIENTES DE REVISIÓN">
                                                <i class="fa fa-list-alt fa-2x blinkimg tr" border=0></i>
                                                {% if qspedidoOnline > 0 %}
                                                    <sup style="top: -10px; left: -3px;"><label
                                                            class="label label-warning"
                                                            style="padding: 4px; font-size: 8px;line-height: 8px;">{{ qspedidoOnline }}</label></sup>
                                                {% endif %}
                                            </a>
                                        </li>
                                    {% endif %}
                                {% endif %}
                                {% if persona %}
                                    <li>
                                        <a>
                                            {% if persona.foto %}
                                                <img src="{{ persona.foto.foto.url }}" width="25" height="25"
                                                     class="img-circle">
                                            {% else %}
                                                {% if persona.sexo_id == 1 %}
                                                    <img src="/static/images/iconos/mujer2.png" width="25" height="25"
                                                         class="img-circle">
                                                {% else %}
                                                    <img src="/static/images/iconos/hombre2.png" width="25" height="25"
                                                         class="img-circle">
                                                {% endif %}
                                            {% endif %}
                                        </a>
                                    </li>
                                {% endif %}
                                {% if persona.tiene_multiples_perfiles %}
                                    <li class="dropdown">
                                        <a href="javascript:;" class="dropdown-toggle"
                                           data-toggle="dropdown">{{ persona.nombre_completo_simple }}<b
                                                class="caret"></b></a>
                                        <ul class="dropdown-menu">
                                            {% for perfil in perfiles_usuario %}
                                                {% if perfil.activo %}
                                                    <li><a {% if perfilprincipal.id == perfil.id %}
                                                        href='javascript:;' {% else %}
                                                        href='/cudu?id={{ perfil.id|encrypt }}'
                                                        class="btn-form" {% endif %}>
                                                        {% if perfilprincipal.id == perfil.id %}
                                                            <i class="fa fa-check"></i>{% endif %} {{ perfil.persona }}
                                                        - ({{ perfil.tipo }})</a></li>
                                                {% endif %}
                                            {% endfor %}
                                        </ul>
                                    </li>
                                {% else %}
                                    <li><a href="javascript:;">{{ persona.nombre_completo_simple }}</a></li>
                                {% endif %}
                            </ul>
                            <li>
                                <a href="/pass" class="tb" data-original-title="Cambiar contraseña"><i
                                        class="fa fa-lock fa-2x"></i></a>
                            </li>
                            {% if persona.usuario.is_superuser %}
                                <li>
                                    <a href="/adminepunemi" target="_blank" class="tb"
                                       data-original-title="Administrar Django"><i class="fa fa-cogs fa-2x"></i></a>
                                </li>
                            {% endif %}
                            <li>
                                <a href="javascript:;" class="logoutuser tb" data-original-title="Cerrar Sesión"><i
                                        class="fa fa-power-off fa-2x"></i></a>
                            </li>
                        </ul>
                    </div>
                    {#                    {% if request.user.is_superuser %}#}
                    <div class="pull-right hidden-phone hidden-tablet visible-desktop">
                        <ul class="nav">
                            <ul style="margin-right: -7px;" class="nav">
                                <li class="dropdown has_hover" style="">
                                    <a style="height: 50px; vertical-align: middle; padding-top: 12px"
                                       href="javascript:;" id="accPeriodo" class="tb"
                                       data-toggle="dropdown"
                                       title="Periodos Fiscales">{{ periodo_fiscal }}</a>
                                    <ul id="listaPeriodos" style="padding: 10px 10px;"
                                        class="dropdown-menu pull-right {% if periodos.count > 10 %}card divScroll square scrollbar-dusty-grass square thin{% endif %}">
                                        <li style="width: 100%;display: block;padding-left: 3%; padding-right: 3px;">
                                            <input type="search" id="buscarPeriodo" autocomplete="off"
                                                   placeholder="Buscar..."
                                                   style="width: 100%;display: block; padding: 3px 15px; float: right; -webkit-border-radius: 20px; border-radius: 20px; margin-top: -4px;"/>
                                        </li>
                                        {% for periodo2 in periodos_todos %}
                                            <li><a href='javascript:;' class='periodoselector'
                                                   pid='{{ periodo2.id|encrypt }}'>
                                                {% if periodo2.id == periodo_fiscal.id %}
                                                    <i class="fa fa-check"></i>{% endif %} {{ periodo2 }}</a></li>
                                        {% endfor %}
                                    </ul>
                                </li>
                            </ul>
                        </ul>
                    </div>
                    {#                    {% endif %}#}
                    <div class="pull-right visible-phone visible-tablet hidden-desktop">
                        <ul class="nav">
                            <li>
                                <a onclick="infoDevNotComp()" class="btnInstalarApp tr" title="Instalar"
                                   style="font-size: 14px; margin-top: 4px;">
                                    <i class="fa fa-android"></i> Instalar
                                </a>
                            </li>
                            {% if persona.tiene_multiples_perfiles %}
                                <ul class="nav">
                                    <li class="dropdown">
                                        <a href="javascript:;" class="dropdown-toggle" data-toggle="dropdown">
                                            {% if persona.foto %}
                                                <img src="{{ persona.foto.foto.url }}" width="25" height="25"
                                                     class="img-circle visible-phone visible-tablet hidden-desktop">
                                            {% else %}
                                                {% if persona.sexo_id == 1 %}
                                                    <img src="/static/images/iconos/mujer2.png" width="25" height="25"
                                                         class="img-circle visible-phone visible-tablet hidden-desktop">
                                                {% else %}
                                                    <img src="/static/images/iconos/hombre2.png" width="25" height="25"
                                                         class="img-circle visible-phone visible-tablet hidden-desktop">
                                                {% endif %}
                                            {% endif %}
                                        </a>
                                        <ul class="dropdown-menu">
                                            {% for perfil in persona.mis_perfilesusuarios %}
                                                <li><a {% if perfilprincipal.id == perfil.id %}
                                                    href='javascript:;' {% else %}
                                                    href='/cudu?id={{ perfil.id|encrypt }}'
                                                    class="btn-form" {% endif %}>
                                                    {% if perfilprincipal.id == perfil.id %}
                                                        <i class="fa fa-check"></i>&nbsp;{% endif %}
                                                    <t class="hidden-phone hidden-tablet visible-desktop">
                                                        &nbsp;{{ perfil.persona }} -
                                                    </t>
                                                    ({{ perfil.tipo }}) {% if not perfil.activo %}
                                                    (INACTIVO){% endif %}
                                                </a>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                    </li>
                                </ul>
                            {% else %}
                                <li>
                                    <a href="javascript:;">
                                        {% if persona.foto %}
                                            <img src="{{ persona.foto.foto.url }}" width="25" height="25"
                                                 class="img-circle visible-phone visible-tablet hidden-desktop">
                                        {% else %}
                                            {% if persona.sexo_id == 1 %}
                                                <img src="/static/images/iconos/mujer2.png" width="25" height="25"
                                                     class="img-circle visible-phone visible-tablet hidden-desktop">
                                            {% else %}
                                                <img src="/static/images/iconos/hombre2.png" width="25" height="25"
                                                     class="img-circle visible-phone visible-tablet hidden-desktop">
                                            {% endif %}
                                        {% endif %}
                                    </a>
                                </li>
                            {% endif %}
                            <li><a href="javascript:;" class="logoutuser"><i class="fa fa-power-off fa-2x"></i></a></li>
                        </ul>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>

    <div id="content">
        <div class='container{% block containertype %}-fluid{% endblock %} table-responsive'>
            {% block alertcanvas %}
            {% endblock %}
            {% if ruta %}
                <div class="row-fluid">
                    <div class="span12">
                        <ul class="breadcrumb">
                            {% for r in ruta %}
                                <li>
                                <span {% if not forloop.first %}class="hidden-phone hidden-tablet visible-desktop"{% endif %}>
                                    <a href="{{ r.0 }}" class="bloqueo_pantalla">{{ r.1 }}</a>
                                    <span class="divider">/</span>
                                </span>
                                </li>
                            {% endfor %}
                            {% if request.path == '/' or request.path == '/panel' %}
                                <input type="text"
                                       style="width:30%;float: right; -webkit-border-radius: 20px;"
                                       id="idbuscador" placeholder="  Buscar...">
                            {% else %}
                                <a style="float: right;"
                                   href="{% if ret %}{{ ret }}{% else %}{% block atras %}/{% endblock %}{% endif %}"
                                   class='btn btn-mini urlatrasbutton bloqueo_pantalla' id="urlatrasbutton"><span
                                        class="fa fa-arrow-left"></span> Atr&aacute;s</a>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            {% endif %}
            {% if not request.user.is_anonymous %}
                {% if messages %}
                    {% for message in messages %}
                        <div class="alert alert-{{ message.tags }} alert-dismissable">
                            <button type="button" class="close" data-dismiss="alert">&times;</button>
                            <i class="fa fa-info-circle"></i> {{ message|safe }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endif %}
            {% block canvas %}
            {% endblock %}
        </div>
    </div>

    {% if not request.user.is_anonymous %}
        {% block footerextra %}
        {% endblock %}
        <div id="nav-footer" class='navbar navbar-fixed-bottom'>
            <div id="nav-footer" class='navbar'>
                <div class="container-fluid">
                    <div class='row-fluid'>
                        <div class="span12">
                            <div class="smaller">
                                <div style="text-align: center; margin-top: -5px;">
                                    <div style="margin-bottom: -5px; font-weight: bold; color: #FFFFFF;text-align: center">
                                            CLÍNICA SANTA ELENA - Todos los derechos reservados
                                        </div>
                                </div>
                                <div style="text-align: right; float: right; margin-top: -5px;"
                                     class="hidden-phone hidden-tablet visible-desktop">
                                    <font><a href="javascript:;"
                                             style="font-size: 24px; color: #fffeec; font-weight: bold"
                                             id="clock"></a></font>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
</div>

<div class="modal fade static" id="waitpanel" style="display: none;">
    <div class="modal-header">
        <h4 id="waitpaneltitle"></h4>
    </div>
    <div class="modal-body">
        <p id="waitpanelbody"></p>
    </div>
</div>

<div class="modal fade static" id="periodospanel" style="display: none;">
    <div class="modal-header">
        <h4 id="paneltitle">Periodos</h4>
    </div>
    <div class="modal-body">
        <select style="width: 100%;" id="periodoselectorall">
            {% for periodo in periodos_todos %}
                <option value="{{ periodo.id|encrypt }}">{{ periodo }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" id="seleccionarperiodospanel" class="btn">Seleccionar</a>
        <a href="javascript:;" id="cerrarperiodospanel" class="btn">Cerrar</a>
    </div>
</div>

<div id="throbber" style="display:none; margin: 0 auto; width: 60px; height: 60px; background-color: #ffffff">
    <img src="/static/images/ajax-document-loader.gif"/>
</div>

<div class="modal fade static" id="formatoreporte" style="display: none;">
    <div class="modal-header">
        <h4 id="paneltitle">Formato de reporte</h4>
    </div>
    <div class="modal-body">
        <select style="width: 100%;" id="formatoreporte_formato">
            <option id="formatopdf" value="0">PORTABLE DOCUMENT FORMAT (PDF)</option>
            <option id="formatodoc" value="1">MICROSOFT WORD (DOCX)</option>
            <option id="formatoxls" value="2">MICROSOFT EXCEL (XLXS)</option>
            <option id="formatocsv" value="3">COMMA-SEPARATED VALUES (CSV)</option>
        </select>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" id="formatoreporte_run" class="btn btn-success">Ejecutar</a>
        <a href="javascript:;" id="formatoreporte_close" class="btn">Cerrar</a>
    </div>
</div>

<div class="modal fade static" id="ficheromodal" style="display: none;">
    <div class="modal-header">
        <h4>Descargar fichero</h4>
    </div>
    <div class="modal-body">
        <a id='enlacefichero' href="javascript:;" target="_blank" class="btn btn-success btn-block"><i
                class="fa fa-arrow-down"></i> Descargar</a>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i class="fa fa-window-close"></i>
            Cerrar</a>
    </div>
</div>

<div class="modal fade static" id="ficheromodalarchivos" style="display: none;width: 20%">
    <div class="modal-header">
        <h4>Descargar archivos</h4>
    </div>
    <div class="modal-body" style="margin:0px;padding:0px;margin-top:22px;margin-bottom:22px">
        <div class="row-fluid" style="margin:10px">
            <div class="span6" style="width: 100px">
                <a id='enlaceficheroexcel' href="javascript:;" target="_blank" class="btn btn-success btn-block"><i
                        class="fa fa-arrow-down"></i> Descargar xml</a>
            </div>
            <div class="span6" style="width: 100px">
                <a id='enlaceficherotxt' href="javascript:;" target="_blank" class="btn btn-info btn-block"><i
                        class="fa fa-arrow-down"></i> Descargar txt</a>
            </div>
        </div>
    </div>
    <div class="modal-footer">
        <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i class="fa fa-window-close"></i>
            Cerrar</a>
    </div>
</div>

<div class="modal fade static" id="confirmacionmodal" style="display: none;"></div>

<div class="modal fade static" id="eliminacionmodal" style="display: none;"></div>

<div class="modal fade static" id="viewhtml" style="display: none;"></div>

<div class="modal fade" id="modalConsulta">
    <div class="modal-dialog">
        <div class="modal-content">
            <form id="frmConsulta" method="post" enctype="multipart/form-data">{% csrf_token %}
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
                    <h4 class="modal-title"><b id="nombre"></b></h4>
                </div>
                <div class="modal-body tablaaqui">
                </div>
                <div class="modal-footer" id="footerModalView">
                    <a href="javascript:;" class="btn btn-default" data-dismiss="modal"><i
                            class="fa fa-window-close"></i>
                        Cerrar</a>
                </div>
            </form>
        </div>
    </div>
</div>

<div id="csrf_tokendiv" style="display: none;">{{ csrf_token }}</div>

{% block moreblock %}
{% endblock %}

<script src="/static/js/fontawesomev3.js" crossorigin="anonymous"></script>

<script>

    //aqui entra
    function getCookie(name) {
        var cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i < cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    var csrftoken = getCookie('csrftoken');

    function csrfSafeMethod(method) {
        return (/^(GET|HEAD|OPTIONS|TRACE)$/.test(method));
    }

    $.ajaxSetup({
        beforeSend: function (xhr, settings) {
            if (!csrfSafeMethod(settings.type) && !this.crossDomain) {
                xhr.setRequestHeader("X-CSRFToken", csrftoken);
            }
        }
    });


    function enviarFirmarDocumento(action, id) {
        var url = '/adm_firmardocumentos?action=' + encodeURIComponent(action) + '&id=' + encodeURIComponent(id);
        var popup = window.open(url, 'Firmar documento', 'width=1000,height=1000');
        popup.focus();
        if (!popup || popup.closed || typeof popup.closed === 'undefined') {
            alert('Ventana fue bloqueado por el navegador.');
        }
        $(popup).on('beforeunload', function () {
            console.log('datos enviados')
        });

        // Agregar escuchador para el evento load en la ventana emergente
        popup.addEventListener('load', function () {
            console.log('La ventana emergente se ha cargado completamente.');
            // Puedes realizar acciones aquí después de que se complete la carga.
            // Esto incluiría las respuestas de las solicitudes que hagas en la ventana emergente.
        });

    }


</script>

{#NOTIFICACIONES WEB#}
{% if False %}
    <script src="/static/webpush/registerSw.js?0.11"></script>
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.ready.then(registration => {
                registration.active.postMessage({type: 'PORT_INITIALIZATION'});
                if ('SyncManager' in window) {
                    registration.sync.register('sync-data');
                }
                navigator.serviceWorker.addEventListener('message', (event) => {
                    var data = event.data;
                    if (data.mensaje) {
                        mensajeSuccess(data.mensaje)
                    }
                    if (data.noti_mensaje) {
                        alertaSuccess(data.noti_mensaje)
                    }
                    if (data.btn_notificaciones) {
                        $('#btnNotificacionTareas').html(data.btn_notificaciones);
                    }
                });
            });
        }
    </script>
    {# btnInstalar app #}
    <script src="/static/device_info/ua-parser.min.js"></script>
    <script src="/static/js/jsencrypt/forge.min.js?v=1.4"></script>
    <script src="/static/js/check_os.js"></script>
    <link rel="stylesheet" type="text/css"
          href="/static/alertsDialogsMobile/alertDialogMaterialDesign/dist/duDialog.css">
    <link rel="stylesheet" type="text/css"
          href="/static/alertsDialogsMobile/alertDialogCupertino/css/component_cupertino.css">
    <script type="text/javascript"
            src="/static/alertsDialogsMobile/alertDialogMaterialDesign/dist/duDialog.js"></script>
    <script src='/static/alertsDialogsMobile/alertDialogCupertino/js/component.js'></script>
    <script>
        let iosConfirmInstall = new ConfirmClass();
        let iosAlert = new AlertClass();
        var mensajeComp = true;

        function recordarDespues() {
            var sec = parseInt(new Date().getTime() / 1000);
            return sec >= parseInt(localStorage.getItem("fechaRecordatorio"));
        }

        function infoDevNotComp() {
            if (mensajeComp) {
                if (isMobile.iOS()) {
                    iosAlert.show({
                        title: 'No compatible',
                        content: 'Su navegador no es compatible para la instalación de la app, de preferencia use Chrome.',
                        btnText: 'Aceptar',
                    })
                } else {
                    duDialog('No compatible', 'Su navegador no es compatible para la instalación de la app, de preferencia use Chrome.', {init: true}).show();
                }
            }
        }

        if (isMobile.Android() || isMobile.iOS() || isMobile.BlackBerry()) {
            const listBtnInstalarApp = $('.btnInstalarApp').toArray();
            window.addEventListener('DOMContentLoaded', () => {
                const classForIconSo = isMobile.Android() ? "fab fa-android" : (isMobile.iOS() || isMobile.Mac()) ? "fab fa-apple" : isMobile.Windows() ? "fab fa-windows" : isMobile.Linux() ? "fab fa-linux" : "fas fa-laptop-code";

                for (var i = 0; i < listBtnInstalarApp.length; i++) {
                    var btnInstalarApp = $(listBtnInstalarApp[i]);
                    btnInstalarApp.children('a').children('i').attr("class", classForIconSo);

                    const buttonAdd = btnInstalarApp;

                    let deferredPrompt;
                    window.addEventListener('beforeinstallprompt', (e) => {
                        $(buttonAdd).removeAttr('style');
                        e.preventDefault();
                        $(buttonAdd).removeAttr('onclick');
                        mensajeComp = false;
                        deferredPrompt = e;
                        buttonAdd.click((e) => {
                            deferredPrompt.prompt();
                            deferredPrompt.userChoice.then((choiceResult) => {
                                if (choiceResult.outcome === 'accepted') {
                                } else {
                                }
                                deferredPrompt = null;
                            });
                        });
                    });
                }
                var btnInsApp = $(listBtnInstalarApp[0]);
                androidConfirmInstall = duDialog('!Bienvenido(a)!', '¿Deseas instalar nuestra app?', {
                    init: true,
                    buttons: duDialog.OK_CANCEL,
                    okText: 'Sí, instalar',
                    cancelText: 'Recordar después',

                    callbacks: {
                        okClick: function (e) {
                            this.hide()
                            btnInsApp.children('a').click();
                        },
                        cancelClick: function (e) {
                            this.hide()
                            var tiempo = parseInt(new Date().getTime() / 1000);
                            var sec = tiempo + 259200;
                            {# despues de 3 días se le presentará el mensaje de nuevo #}
                            localStorage.setItem("fechaRecordatorio", sec.toString());
                        },
                    }
                });
                if (window.matchMedia('(display-mode: standalone)').matches) {
                    btnInsApp.remove();
                } else {
                    if (localStorage.getItem("fechaRecordatorio") === null || recordarDespues()) {
                        if (isMobile.iOS()) {
                            iosConfirmInstall.show({
                                title: '¡Bievenido(a)!',
                                content: '¿Deseas instalar nuestra app?',
                                btns: [{
                                    text: 'Sí, instalar',
                                    callback: function (instance) {
                                        instance.close = false;
                                        btnInsApp.children('a').click();
                                    }
                                }, {
                                    text: 'Recordar después',
                                    callback: function () {
                                        var tiempo = parseInt(new Date().getTime() / 1000);
                                        var sec = tiempo + 259200;
                                        {# despues de 3 días se le presentará el mensaje de nuevo #}
                                        localStorage.setItem("fechaRecordatorio", sec.toString());
                                    }
                                }],
                                onShow: function () {

                                }
                            });
                        } else {
                            androidConfirmInstall.show();
                        }
                    }
                }
            });
        }
    </script>
    <script src="/static/devtools-detect/devtools-detect.js"></script>
{% endif %}
{#NOTIFICACIONES WEB#}

</body>

</html>